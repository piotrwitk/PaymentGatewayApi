# Git repo:
Available here: https://dev.azure.com/creativecloudlab/_git/PaymentGatewayApi

# Assumptions
Communicating with a bank is synchronous. In some cases it would make sense to implement a call-back mechanism for a bank, in case the processing takes a long time (e.g. waiting for user to approve via mobile app on the retrieval of push notification) providing for a bank a call-back endpoint would make sense

There's no incoming data validation for now. Missing bits:
- is requested data present?
- is it in the right format (card number, valid from/to)
- is the currency symbol in the right format
- is the amount in transaction > 0?

# Running the service
Clone repo and run from Visual Studio. The service will be available under https://localhost:44310/.

Note the data persistence and communication with external bank are stubbed/mocked, but in the future should be easy to swap via dependency injection.

# CI/CD
The master branch is guarded, so no direct changes are allowed.
Every change has to go via development branch and pull request.
All tests need to pass before merge is possible.
There are two CI pipelines, one for dev branches, one for master.

Currently there is no CD. In the future a green/blue deployment or at least staging / production with the option to swap when could be implemented.

There should be a sandbox environment available for the customers as well, so they could play with new features / pre release changes / for testing and onboarding

Build pipelines + history available to view here: https://dev.azure.com/creativecloudlab/PaymentGatewayApi/_build

# API versioning
Due to time constraints, a simple URL versioning is in place, e.g.: api/V1/payment

# API documentation and client
The API can be poked with via SWAGGER.
Client is currently not available, but with swagger in the mix it would be easy to auto generate a set of clients and publish them via e.g. nuget.

# Logging
Currently no logging.
An implementation of an ILogger could be used, depending on what will be on the receiving end of the data.

# Metrics
None in place atm.
Some  that should be added:
- number of requests / searches
- number of 200/4XX/5XX response statuses (from bank and from the service itself)
- latency on IO operations
- latency on communication with a bank
- volume od data in/out
- end to end latency
- CPU / Memory / GC
- Health checks (there's a stub version of a health check, but currently always returns HEALTHY status)

# Encryption
Only traffic over HTTPs should be permitted

## Data encryption
Card number is replaced with ***** and never stored for this version. Only last for digits are stored. In the future this should be replaced by a proper encyption. Important data should be encrypted, a key rotation for decryption/decryption should be in place

# Authentication
None in place. Ideally the caller should present a Bearer token obtained via OAuth. Alternatively a secret key could be generated by the system. With primary/secondary it would be possible to rotate those keys as well.

# Performance testing
We should check metrics on the PROD system all the time.

For performance for a new version, we could either create a dedicated environment, that shadows the traffic (may be difficult due to the nature of the data, and dependency on a bank), or create a testing script with increased number of simulated clients and requests.

# Data storage
Data is not being persisted for now (only a volatile in-memory repository is used). But this would be easy to improve in the next phase, by injecting a proper storage implementation.

There are two "tables" for data. One storing all received requests (in a way it is a ledger).
The other one contains data along with bank's response, and is used to provide retrieve requirement.

No merchant adding / onboarding is implemented at the moment, also no authentication.

# Simulating a bank
An injectable wrapper is being used, so it could be easily replaced
See: https://dev.azure.com/creativecloudlab/PaymentGatewayApi/_git/PaymentGatewayApi?path=%2FPaymentGateway%2FPaymentGateway%2FPaymentProcessors